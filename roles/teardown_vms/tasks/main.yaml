---

- name: print the list of VMs given from teardown.yaml
  debug:
    var: vms

- name: print the number of VMs given from teardown.yaml
  debug:
    var: "{{ vms | length }}"

- name: shutdown listed VMs
  community.libvirt.virt:
    name: "{{ item }}"
    command: shutdown
  loop: "{{ vms }}"

- name: wait up to 5 minute for VMs to shutdown gracefully
  pause:
    minutes: 5

- name: undefine listed VMs
  community.libvirt.virt:
    name: "{{ item }}"
    command: undefine
  loop: "{{ vms }}"